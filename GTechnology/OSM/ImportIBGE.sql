SET ECHO ON;
SPOOL IMPORTING_IBGE.LOG;

------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------DELETANDO REGISTROS DUPLICADOS-----------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------

DELETE FROM
       ESTADOS_IBGE A
WHERE
       ROWID > (
             SELECT MIN(ROWID)
             FROM
             ESTADOS_IBGE B      
             WHERE
             A.ID = B.ID
             );
COMMIT;			
              

------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------ESTADO-----------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------
INSERT INTO GC_ESTADO_IBGE
  SELECT GC_ESTADO_IBGE_SEQ.NEXTVAL,
         21800,
         21801,
         G3E_FID_SEQ.NEXTVAL,
         1,
         ID,
         NOME,
         SIGLA,
         TOTAL,
         CODIGO_IBG
    FROM ESTADOS_IBGE
	COMMIT;
	
INSERT INTO GC_ESTADO_IBGE_P
  SELECT A.G3E_ID, 21800, 21810, A.G3E_FID, 1, B.GEOMETRY
    FROM GC_ESTADO_IBGE A, ESTADOS_IBGE B
   WHERE A.SIGLA = B.SIGLA;
COMMIT;

------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------MUNICIPIO-----------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------

INSERT INTO GC_MUNICIPIO_IBGE
  SELECT GC_MUNICIPIO_IBGE_SEQ.NEXTVAL,
         21700,
         21701,
         G3E_FID_SEQ.NEXTVAL,
         1,
         M.ID,
         M.NOME,
         E.NOME,
         M.UF,
         POPULACAO,
         PIB,
         M.CODIGO_IBG
    FROM MUNICIPIOS_2010 M, ESTADOS_IBGE E
   WHERE M.ESTADO_ID = E.ID;
COMMIT;

INSERT INTO GC_MUNICIPIO_IBGE_P
  SELECT G.G3E_ID, 21700, 21710,G.G3E_FID, 1, M.GEOMETRY
    FROM GC_MUNICIPIO_IBGE G, MUNICIPIOS_2010 M
   WHERE G.OSM_ID = M.ID;
COMMIT;   

SPOOL OFF;

