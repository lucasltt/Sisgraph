SET echo ON;

SPOOL Divisor.LOG;

CREATE OR REPLACE VIEW VGC_ONU_S AS
SELECT
A.G3E_ID,
A.G3E_FNO,
A.G3E_CNO,
A.G3E_FID,
A.G3E_CID,
A.G3E_GEOMETRY,
B.JOB_STATE,
B.FEATURE_STATE,
B.MIN_MATERIAL,
C.NAME,
C.MODEL,
C.MATERIAL_TYPE,
C.LOCAL_INSTALACAO
FROM GC_ONU_S A,
     GC_NETELEM B,
     GC_ONU C
WHERE A.G3E_FNO = 12100
  AND A.G3E_FID = B.G3E_FID
  AND A.G3E_FID = C.G3E_FID;
  
CREATE OR REPLACE VIEW VDGC_ONU_S AS
SELECT
A.G3E_ID,
A.G3E_FNO,
A.G3E_CNO,
A.G3E_FID,
A.G3E_CID,
A.G3E_GEOMETRY,
A.G3E_DETAILID,
B.JOB_STATE,
B.FEATURE_STATE,
B.MIN_MATERIAL,
C.NAME,
C.MODEL,
C.MATERIAL_TYPE,
C.LOCAL_INSTALACAO
FROM DGC_ONU_S A,
     GC_NETELEM B,
     GC_ONU C
WHERE A.G3E_FNO = 12100
  AND A.G3E_FID = B.G3E_FID
  AND A.G3E_FID = C.G3E_FID;

CREATE OR REPLACE VIEW VGC_ONU_T AS
SELECT 
A.G3E_ID, 
A.G3E_FNO, 
A.G3E_CNO, 
A.G3E_FID, 
A.G3E_CID, 
A.G3E_GEOMETRY, 
A.G3E_ALIGNMENT, 
A.SEQ, 
B.NAME, 
B.MATERIAL_TYPE, 
B.LOCAL_INSTALACAO, 
C.MIN_MATERIAL 
FROM GC_ONU_T A, 
	 GC_ONU B, 
	 GC_NETELEM C
WHERE C.G3E_FNO = 12100 AND A.G3E_FID = B.G3E_FID AND B.G3E_FID = C.G3E_FID;
  
CREATE OR REPLACE VIEW VDGC_ONU_T AS
SELECT
A.G3E_ID G3E_ID,
A.G3E_FNO G3E_FNO,
A.G3E_CNO G3E_CNO,
A.G3E_FID G3E_FID,
A.G3E_CID G3E_CID,
A.G3E_GEOMETRY G3E_GEOMETRY,
A.G3E_ALIGNMENT G3E_ALIGNMENT,
A.G3E_DETAILID G3E_DETAILID,
B.JOB_STATE JOB_STATE,
B.FEATURE_STATE FEATURE_STATE,
C.NAME,
C.MATERIAL_TYPE,
C.LOCAL_INSTALACAO,
B.MIN_MATERIAL
FROM DGC_ONU_T A,
     GC_NETELEM B,
     GC_ONU C
WHERE B.G3E_FNO = 12100
  AND A.G3E_FID = B.G3E_FID
  AND A.G3E_FID = C.G3E_FID;  
  
INSERT INTO G3E_COMPONENTVIEWCOMPOSITION VALUES (1213051, 12130, 51, NULL, SYSDATE, 12100);
INSERT INTO G3E_COMPONENTVIEWCOMPOSITION VALUES (1213151, 12131, 51, NULL, SYSDATE, 12100);
COMMIT;  
  
CALL G3E_MANAGEMODLOG.SyncToComponentView('VGC_ONU_S');
CALL G3E_MANAGEMODLOG.SyncToComponentView('VDGC_ONU_S');
CALL G3E_MANAGEMODLOG.SyncToComponentView('VGC_ONU_T');
CALL G3E_MANAGEMODLOG.SyncToComponentView('VDGC_ONU_T');
COMMIT;
execute MG3ElanguageSubTableUtils.SynchronizeSubTables;
COMMIT;
execute MG3EOTCreateOptimizedTables;
COMMIT;
execute MG3ECreateOptableViews;
COMMIT;

execute ComponentQuery.Generate;
commit;
execute ComponentViewQuery.Generate;
commit;
execute gc_compileinvalidobjects;
commit;
----------------------------------------------INSERINDO OS TIPOS DE DIVISORES----------------------------------------------------
INSERT INTO REF_ONU VALUES('Div 1:2', '1:2', '1:2', NULL, NULL, NULL, NULL, 'Divisor', '1:2', NULL, NULL, NULL);
INSERT INTO REF_ONU VALUES('Div 1:3', '1:3', '1:3', NULL, NULL, NULL, NULL, 'Divisor', '1:3', NULL, NULL, NULL);
INSERT INTO REF_ONU VALUES('DC 1:2', '1:2', '1:2', NULL, NULL, NULL, NULL, 'Divisor', '1:2', NULL, NULL, NULL);
COMMIT;



INSERT INTO g3e_pointstyle VALUES (12120005, 'Divisor 1:2',16711935,'iwhfc','A','I',20,1,0,1,SYSDATE,NULL,1,0,NULL,NULL);
INSERT INTO g3e_pointstyle VALUES (12120006, 'Divisor 1:3',16711935,'iwhfc','B','I',20,1,0,1,SYSDATE,NULL,1,0,NULL,NULL);
INSERT INTO g3e_pointstyle VALUES (12120007, 'Divisor DC 1:2',16711935,'iwhfc','C','I',20,1,0,1,SYSDATE,NULL,1,0,NULL,NULL);
COMMIT;

UPDATE G3E_STYLERULE SET G3E_FILTERORDINAL = G3E_FILTERORDINAL + 3 WHERE G3E_SRNO = 1212001;
COMMIT;

INSERT INTO g3e_stylerule VALUES (121200105,1212001,'Simbolo do Divisor 1:2','MATERIAL_TYPE = ''Divisor'' AND MIN_MATERIAL = ''Div 1:2''',1,12120005,SYSDATE,'Simbolo do Divisor 1:2',NULL);
COMMIT;

INSERT INTO g3e_stylerule VALUES (121200106,1212001,'Simbolo do Divisor 1:3','MATERIAL_TYPE = ''Divisor'' AND MIN_MATERIAL = ''Div 1:3''',2,12120006,SYSDATE,'Simbolo do Divisor 1:3',NULL);
COMMIT;

INSERT INTO g3e_stylerule VALUES (121200107,1212001,'Simbolo do Divisor DC 1:2','MATERIAL_TYPE = ''Divisor'' AND MIN_MATERIAL = ''DC 1:2''',3,12120007,SYSDATE,'Simbolo do Divisor DC 1:2',NULL);
COMMIT;


INSERT INTO g3e_dialogtab VALUES (1210105, 'Divisor', 'V', SYSDATE, NULL, NULL, NULL);
COMMIT;

INSERT INTO g3e_dialog VALUES(1210501, 12101, 'Divisor', 12100, 1, NULL, 1210105, SYSDATE);
COMMIT;

-- Inserindo as Tab_Attribute para o g3e_dialogtab

insert into G3E_TABATTRIBUTE (G3E_TANO, G3E_ANO, G3E_ORDINAL, G3E_PNO, G3E_READONLY, G3E_DEFAULT, G3E_REFRESH, G3E_DTNO, G3E_FIELDVALUEFILTER, G3E_TRAVERSALANO, G3E_EDITDATE, G3E_TRIGGERPOPULATE, G3E_USEFILTERTOTRANSLATEKEY, G3E_FKQRINO, G3E_FKQARGGROUPNO)
values (121010501, 1210106, 3, null, 0, null, 1, 1210105, null, null, to_date('28-08-2013 14:12:50', 'dd-mm-yyyy hh24:mi:ss'), 0, 0, null, null);

insert into G3E_TABATTRIBUTE (G3E_TANO, G3E_ANO, G3E_ORDINAL, G3E_PNO, G3E_READONLY, G3E_DEFAULT, G3E_REFRESH, G3E_DTNO, G3E_FIELDVALUEFILTER, G3E_TRAVERSALANO, G3E_EDITDATE, G3E_TRIGGERPOPULATE, G3E_USEFILTERTOTRANSLATEKEY, G3E_FKQRINO, G3E_FKQARGGROUPNO)
values (121010502, 1210107, 4, 12102, 0, null, 0, 1210105, '#5114=MIN_MATERIAL|#5114 IS NULL', null, to_date('28-08-2013 14:12:50', 'dd-mm-yyyy hh24:mi:ss'), 0, 0, null, null);

insert into G3E_TABATTRIBUTE (G3E_TANO, G3E_ANO, G3E_ORDINAL, G3E_PNO, G3E_READONLY, G3E_DEFAULT, G3E_REFRESH, G3E_DTNO, G3E_FIELDVALUEFILTER, G3E_TRAVERSALANO, G3E_EDITDATE, G3E_TRIGGERPOPULATE, G3E_USEFILTERTOTRANSLATEKEY, G3E_FKQRINO, G3E_FKQARGGROUPNO)
values (121010503, 5111, 5, null, 0, null, 0, 1210105, null, null, to_date('28-08-2013 14:12:50', 'dd-mm-yyyy hh24:mi:ss'), 0, 0, null, null);

insert into G3E_TABATTRIBUTE (G3E_TANO, G3E_ANO, G3E_ORDINAL, G3E_PNO, G3E_READONLY, G3E_DEFAULT, G3E_REFRESH, G3E_DTNO, G3E_FIELDVALUEFILTER, G3E_TRAVERSALANO, G3E_EDITDATE, G3E_TRIGGERPOPULATE, G3E_USEFILTERTOTRANSLATEKEY, G3E_FKQRINO, G3E_FKQARGGROUPNO)
values (121010504, 5108, 6, 90, 0, null, 1, 1210105, null, null, to_date('28-08-2013 14:12:50', 'dd-mm-yyyy hh24:mi:ss'), 0, 0, null, null);

insert into G3E_TABATTRIBUTE (G3E_TANO, G3E_ANO, G3E_ORDINAL, G3E_PNO, G3E_READONLY, G3E_DEFAULT, G3E_REFRESH, G3E_DTNO, G3E_FIELDVALUEFILTER, G3E_TRAVERSALANO, G3E_EDITDATE, G3E_TRIGGERPOPULATE, G3E_USEFILTERTOTRANSLATEKEY, G3E_FKQRINO, G3E_FKQARGGROUPNO)
values (121010505, 5107, 7, 35, 0, 'PRP', 1, 1210105, null, null, to_date('28-08-2013 14:12:50', 'dd-mm-yyyy hh24:mi:ss'), 0, 0, null, null);

insert into G3E_TABATTRIBUTE (G3E_TANO, G3E_ANO, G3E_ORDINAL, G3E_PNO, G3E_READONLY, G3E_DEFAULT, G3E_REFRESH, G3E_DTNO, G3E_FIELDVALUEFILTER, G3E_TRAVERSALANO, G3E_EDITDATE, G3E_TRIGGERPOPULATE, G3E_USEFILTERTOTRANSLATEKEY, G3E_FKQRINO, G3E_FKQARGGROUPNO)
values (121010506, 5106, 8, 31, 1, null, 0, 1210105, null, null, to_date('28-08-2013 14:12:50', 'dd-mm-yyyy hh24:mi:ss'), 0, 0, null, null);

insert into G3E_TABATTRIBUTE (G3E_TANO, G3E_ANO, G3E_ORDINAL, G3E_PNO, G3E_READONLY, G3E_DEFAULT, G3E_REFRESH, G3E_DTNO, G3E_FIELDVALUEFILTER, G3E_TRAVERSALANO, G3E_EDITDATE, G3E_TRIGGERPOPULATE, G3E_USEFILTERTOTRANSLATEKEY, G3E_FKQRINO, G3E_FKQARGGROUPNO)
values (121010507, 5112, 9, null, 0, null, 0, 1210105, null, null, to_date('28-08-2013 14:12:50', 'dd-mm-yyyy hh24:mi:ss'), 0, 0, null, null);

insert into G3E_TABATTRIBUTE (G3E_TANO, G3E_ANO, G3E_ORDINAL, G3E_PNO, G3E_READONLY, G3E_DEFAULT, G3E_REFRESH, G3E_DTNO, G3E_FIELDVALUEFILTER, G3E_TRAVERSALANO, G3E_EDITDATE, G3E_TRIGGERPOPULATE, G3E_USEFILTERTOTRANSLATEKEY, G3E_FKQRINO, G3E_FKQARGGROUPNO)
values (121010508, 1210108, 2, 12191, 1, 'Divisor', 1, 1210105, NULL, null, to_date('28-08-2013 14:12:50', 'dd-mm-yyyy hh24:mi:ss'), 0, 0, null, null);

insert into G3E_TABATTRIBUTE (G3E_TANO, G3E_ANO, G3E_ORDINAL, G3E_PNO, G3E_READONLY, G3E_DEFAULT, G3E_REFRESH, G3E_DTNO, G3E_FIELDVALUEFILTER, G3E_TRAVERSALANO, G3E_EDITDATE, G3E_TRIGGERPOPULATE, G3E_USEFILTERTOTRANSLATEKEY, G3E_FKQRINO, G3E_FKQARGGROUPNO)
values (121010509, 5110, 11, null, 1, null, 0, 1210105, null, null, to_date('28-08-2013 14:12:50', 'dd-mm-yyyy hh24:mi:ss'), 0, 0, null, null);

insert into G3E_TABATTRIBUTE (G3E_TANO, G3E_ANO, G3E_ORDINAL, G3E_PNO, G3E_READONLY, G3E_DEFAULT, G3E_REFRESH, G3E_DTNO, G3E_FIELDVALUEFILTER, G3E_TRAVERSALANO, G3E_EDITDATE, G3E_TRIGGERPOPULATE, G3E_USEFILTERTOTRANSLATEKEY, G3E_FKQRINO, G3E_FKQARGGROUPNO)
values (121010511, 5114, 1, 12192, 0, null, 1, 1210105, '#1210108=MATERIAL_TYPE|#1210108 IS NULL', null, to_date('31-03-2009 10:14:17', 'dd-mm-yyyy hh24:mi:ss'), 1, 0, null, null);
 
COMMIT;

--REFRESH = 1 PARA TODOS AS TABATTRIBUE NOME Q SERÃO UTILIZADAS NO COMPONENTE DE TEXTO
UPDATE G3E_TABATTRIBUTE SET G3E_REFRESH = 1 WHERE G3E_ANO = 1210106;
COMMIT;

--ARRUMANDO O G3E_TABATTRIBUTE PARA REFRESH = 1 ONDE O ATRIBUTO É O TIPO DO MATERIAL
UPDATE G3E_TABATTRIBUTE SET G3E_REFRESH = 1 WHERE G3E_ANO = 1210108;
COMMIT;
--ARRUMANDO O G3E_TABATTRIBUTE PARA REFRESH = 1 ONDE O ATRIBUTO É O MIN_MATERIAL
UPDATE G3E_TABATTRIBUTE SET G3E_REFRESH = 1 WHERE G3E_TANO IN (121010111, 121010211,121010311,121010411);
COMMIT;

INSERT INTO g3e_compconfiguration VALUES (112002, 12102, 'Divisor', 12100, 12120, 2, 0, 7, NULL, 0, NULL, NULL, SYSDATE, NULL);
COMMIT;

INSERT INTO g3e_placementconfiguration VALUES (1210102, 12102, 'Divisor', 12100, NULL, 1, 0, 7, NULL, NULL, 1, 1, SYSDATE, NULL, NULL, 1, 0, 12102, 1, NULL, NULL, NULL);
COMMIT;

UPDATE g3e_placementselection SET g3e_ordinal = g3e_ordinal + 1 WHERE g3e_ordinal > 60;
COMMIT;


INSERT INTO g3e_placementselection VALUES (12102, NULL, ',Divisor', 2, 61, SYSDATE,  (SELECT MAX(g3e_psrowno) + 1 FROM g3e_placementselection), NULL, 153, 'EVERYONE');
COMMIT;

/* Comentando pois ira usar o mesmo padrao do amplificador
-- Inserindo as regras do Componente de Texto
INSERT INTO G3E_LABEL VALUES ('1213002', 'Texto do Divisor', '[NAME]', SYSDATE, NULL);
COMMIT;

UPDATE G3E_LABELRULE SET G3E_FILTERORDINAL = G3E_FILTERORDINAL + 1 WHERE G3E_LRNO = 1213001;
COMMIT;

INSERT INTO G3E_LABELRULE VALUES (121300102, 1213001, 'Texto do Divisor', 'MATERIAL_TYPE=''Divisor''', 1, 1213002, SYSDATE);
COMMIT;
*/
SPOOL OFF;

